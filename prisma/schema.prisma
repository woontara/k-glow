// Prisma Schema for K-Glow Platform

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// 사용자
model User {
  id                     String                  @id @default(cuid())
  email                  String                  @unique
  name                   String
  emailVerified          DateTime?
  image                  String?
  password               String?
  role                   UserRole                @default(BRAND)
  companyName            String?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt

  // 브랜드 연결 (BRAND 역할 사용자용)
  brandId                String?
  brand                  Brand?                  @relation(fields: [brandId], references: [id])

  certificationRequests  CertificationRequest[]
  quotes                 Quote[]
  accounts               Account[]
  sessions               Session[]
  uploadedProducts       UploadedProduct[]

  @@index([brandId])
  @@map("users")
}

// 브랜드 (한국 브랜드 고객사 - 마켓플레이스 SKU 필터링용)
model Brand {
  id                     String                  @id @default(cuid())
  name                   String                  // 브랜드명 (영문)
  nameKo                 String                  // 브랜드명 (한글)
  skuPrefix              String                  @unique // SKU 접두사 (예: "BRAND1", "ABC")
  description            String?                 // 브랜드 설명
  logoUrl                String?                 // 로고 URL
  websiteUrl             String?                 // 웹사이트 URL
  contactEmail           String?                 // 담당자 이메일
  contactPhone           String?                 // 담당자 연락처
  isActive               Boolean                 @default(true)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt

  users                  User[]                  // 이 브랜드에 속한 사용자들

  @@index([skuPrefix])
  @@index([isActive])
  @@map("brands")
}

enum UserRole {
  BRAND
  BUYER
  ADMIN
}

// 파트너사 (한국 브랜드)
model Partner {
  id                     String                  @id @default(cuid())
  name                   String
  nameRu                 String
  websiteUrl             String
  logoUrl                String?
  description            String
  descriptionRu          String
  marketScore            Int                     @default(0)
  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt

  products               Product[]
  certificationRequests  CertificationRequest[]

  @@map("partners")
}

// 제품
model Product {
  id                     String                  @id @default(cuid())
  partnerId              String
  partner                Partner                 @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  name                   String
  nameRu                 String
  category               String
  price                  Float
  priceRub               Float
  ingredients            Json                    // String[]
  ingredientsRu          Json                    // String[]
  description            String
  descriptionRu          String
  imageUrls              Json                    // String[]

  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt

  @@index([partnerId])
  @@map("products")
}

// 인증 신청
model CertificationRequest {
  id                     String                  @id @default(cuid())
  userId                 String
  user                   User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  partnerId              String
  partner                Partner                 @relation(fields: [partnerId], references: [id], onDelete: Cascade)

  certType               CertificationType
  status                 CertificationStatus     @default(PENDING)
  documents              Json                    // String[]
  estimatedCost          Float
  notes                  String?

  createdAt              DateTime                @default(now())
  updatedAt              DateTime                @updatedAt

  @@index([userId])
  @@index([partnerId])
  @@index([status])
  @@map("certification_requests")
}

enum CertificationType {
  EAC
  GOST
  OTHER
}

enum CertificationStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  REJECTED
}

// 견적
model Quote {
  id                     String                  @id @default(cuid())
  userId                 String
  user                   User                    @relation(fields: [userId], references: [id], onDelete: Cascade)

  products               Json                    // QuoteProduct[]
  totalKrw               Float
  totalRub               Float
  shippingCost           Float
  certificationCost      Float
  exchangeRate           Float

  createdAt              DateTime                @default(now())

  @@index([userId])
  @@map("quotes")
}

// 상품 상세페이지 리빌드
model ProductRebuild {
  id                String   @id @default(cuid())
  sourceUrl         String
  sourceSite        String   // coupang, naver, 11st, generic

  // 한국어 원본
  name              String
  price             Float?
  priceOriginal     String?
  description       String

  // 러시아어 번역
  nameRu            String
  descriptionRu     String

  // 성분
  ingredients       Json     // String[]
  ingredientsRu     Json     // String[]

  // 이미지
  screenshotUrl     String?
  imageUrls         Json     // String[] - 다운로드된 로컬 경로
  originalImageUrls Json     // String[] - 원본 URL

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([sourceUrl])
  @@index([sourceSite])
  @@map("product_rebuilds")
}

// 업로드된 상품 (cafe24 양식)
model UploadedProduct {
  id                String   @id @default(cuid())
  userId            String
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  productCode       String?  // 상품코드
  customCode        String?  // 자체 상품코드
  displayStatus     Boolean  @default(true)  // 진열상태
  saleStatus        Boolean  @default(true)  // 판매상태
  name              String   // 상품명
  nameEn            String?  // 영문 상품명
  price             Int      @default(0)     // 판매가
  supplyPrice       Int?     // 공급가
  retailPrice       Int?     // 소비자가
  manufacturer      String?  // 제조사
  brand             String?  // 브랜드
  origin            String?  // 원산지
  description       String?  // 상품 상세설명
  shortDescription  String?  // 상품 간략설명
  rawData           Json     // 원본 CSV 데이터 전체

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([userId])
  @@index([brand])
  @@map("uploaded_products")
}

// 문의하기
model ContactInquiry {
  id        String        @id @default(cuid())
  name      String        // 담당자명
  company   String        // 회사명
  email     String        // 이메일
  phone     String?       // 연락처
  service   String        // 관심 서비스
  message   String        // 문의 내용
  status    InquiryStatus @default(PENDING)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([status])
  @@index([email])
  @@map("contact_inquiries")
}

enum InquiryStatus {
  PENDING     // 대기중
  IN_PROGRESS // 처리중
  COMPLETED   // 완료
}

// 포트폴리오 (성공 사례)
model Portfolio {
  id              String            @id @default(cuid())

  // 브랜드 정보
  brand           String            // 브랜드명
  brandLogoUrl    String?           // 브랜드 로고 URL
  brandWebsite    String?           // 브랜드 웹사이트
  category        PortfolioCategory // 제품 카테고리

  // 프로젝트 정보
  title           String            // 핵심 성과 한줄 (예: "Wildberries 입점 3개월 만에 월 매출 5억 달성")
  marketplaces    Json              // 입점 마켓플레이스 (예: ["Wildberries", "Ozon"])
  services        Json              // 제공 서비스 (예: ["EAC 인증", "입점 대행", "마케팅"])
  projectYear     String?           // 프로젝트 연도 (예: "2024")
  duration        String?           // 소요 기간 (예: "3개월")

  // 성과 지표
  monthlySales    String?           // 월 매출 (예: "5억+")
  productCount    String?           // 입점 상품 수 (예: "12종")
  rating          String?           // 마켓플레이스 평점 (예: "4.8")
  achievement     String?           // 주요 성과 (예: "뷰티 카테고리 TOP 10 진입")

  // 스토리
  challenge       String?           // 고객의 도전 과제/니즈
  solution        String?           // K-Glow의 솔루션
  results         String?           // 결과/성과 상세 설명

  // 표시 설정
  imageUrl        String            // 대표 이미지 URL
  gradient        String            @default("from-[#8BA4B4] to-[#6B8A9A]")
  isActive        Boolean           @default(true)
  isFeatured      Boolean           @default(false) // 메인 페이지 노출 여부
  order           Int               @default(0)

  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@index([category])
  @@index([isActive])
  @@index([isFeatured])
  @@map("portfolios")
}

enum PortfolioCategory {
  SKINCARE
  MAKEUP
  HAIRCARE
  BODYCARE
  OTHER
}

// 고객 후기
model Testimonial {
  id        String   @id @default(cuid())
  name      String   // 고객명
  company   String   // 회사명
  content   String   // 후기 내용
  gradient  String   @default("from-[#8BA4B4] to-[#6B8A9A]")
  isActive  Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([isActive])
  @@map("testimonials")
}

// NextAuth.js 모델
model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}
